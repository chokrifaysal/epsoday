#include <stdint.h>
#include <stdlib.h>
#include <string.h>

// FFI bridge for Rust-C integration
typedef struct {
    uint64_t base_addr;
    uint64_t libc_base;
    uint8_t* payload;
    size_t payload_len;
} exploit_ctx_t;

// Rust function declarations
extern int rust_exploit_init(void* ctx);
extern int rust_heap_spray(void* ctx);
extern int rust_rop_chain(void* ctx);
extern uint8_t* rust_encode(const uint8_t* data, size_t len, uint8_t key);
extern void rust_free_encoded(uint8_t* ptr);

// C wrapper functions
int exploit_init(exploit_ctx_t* ctx) {
    return rust_exploit_init(ctx);
}

int exploit_heap_spray(exploit_ctx_t* ctx) {
    return rust_heap_spray(ctx);
}

int exploit_rop_chain(exploit_ctx_t* ctx) {
    return rust_rop_chain(ctx);
}

uint8_t* encode_payload(const uint8_t* data, size_t len, uint8_t key) {
    return rust_encode(data, len, key);
}

void free_encoded_payload(uint8_t* ptr) {
    rust_free_encoded(ptr);
}
